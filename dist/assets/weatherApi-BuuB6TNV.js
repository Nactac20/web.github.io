const c="74b46c1ed4262ce326ca8d2dc5df63e3",i="https://api.openweathermap.org",d=()=>c.trim()!=="",w=e=>({city:e.name,temperature:Math.round(e.main.temp),feels_like:Math.round(e.main.feels_like),humidity:e.main.humidity,pressure:e.main.pressure,windSpeed:Math.round(e.wind.speed*10)/10,cloudiness:e.clouds.all,description:e.weather[0].description,icon:e.weather[0].icon,sunrise:e.sys.sunrise,sunset:e.sys.sunset}),u=e=>{var o;if(e.response)switch(e.response.status){case 404:throw new Error("City not found. Please check the city name");case 401:throw new Error("Invalid API key.");case 429:throw new Error("API rate limit exceeded.");default:throw new Error(`API Error: ${e.response.status} - ${((o=e.response.data)==null?void 0:o.message)||"Unknown error"}`)}else throw e.request?new Error("Network error. Please check your internet connection."):new Error(`Request failed: ${e.message}`)},p=async e=>{if(!d())throw new Error("API key not configured.");const o=e.trim();if(!o)throw new Error("Please enter a valid city name.");try{const r=`${i}/data/2.5/weather?q=${encodeURIComponent(o)}&appid=${c}&units=metric`,t=await fetch(r);if(!t.ok){const a=await t.json(),n=new Error(a.message||"API request failed");throw n.response={status:t.status,data:a},n}const s=await t.json();return w(s)}catch(r){console.error("Weather API Error:",r),u(r)}},y=async(e,o)=>{if(!d())throw new Error("API key not configured.");if(e===void 0||o===void 0)throw new Error("Latitude and longitude are required for location-based weather data.");try{const r=`${i}/data/2.5/weather?lat=${e}&lon=${o}&appid=${c}&units=metric`,t=await fetch(r);if(!t.ok){const a=await t.json(),n=new Error(a.message||"API request failed");throw n.response={status:t.status,data:a},n}const s=await t.json();return w(s)}catch(r){console.error("Weather API Error:",r),u(r)}},E=async(e,o)=>{if(!d())throw new Error("API key not configured.");if(e===void 0||o===void 0)throw new Error("Latitude and longitude are required for location-based weather forecast.");try{const r=`${i}/data/2.5/forecast?lat=${e}&lon=${o}&appid=${c}&units=metric`,t=await fetch(r);if(!t.ok){const a=await t.json(),n=new Error(a.message||"Forecast API request failed");throw n.response={status:t.status,data:a},n}const s=await t.json();return m(s)}catch(r){console.error("Forecast API Error:",r),u(r)}},I=async e=>{if(!d())throw new Error("API key not configured.");const o=e.trim();if(!o)throw new Error("Please enter a valid city name.");try{const r=`${i}/data/2.5/forecast?q=${encodeURIComponent(o)}&appid=${c}&units=metric`,t=await fetch(r);if(!t.ok){const a=await t.json(),n=new Error(a.message||"Forecast API request failed");throw n.response={status:t.status,data:a},n}const s=await t.json();return m(s)}catch(r){console.error("Forecast API Error:",r),u(r)}},m=e=>{const o={};e.list.forEach(t=>{const s=t.dt_txt.split(" ")[0];o[s]||(o[s]={date:s,temperatures:[],weatherItems:[]}),o[s].temperatures.push(t.main.temp),o[s].weatherItems.push({description:t.weather[0].description,icon:t.weather[0].icon})});const r=Object.values(o).map(t=>{const s=Math.min(...t.temperatures),a=Math.max(...t.temperatures),n=t.weatherItems.find(f=>f.description.includes("clear"))||t.weatherItems[Math.floor(t.weatherItems.length/2)],l=new Date(t.date).toLocaleDateString("en-US",{weekday:"short"});return{date:t.date,dayName:l,minTemp:Math.round(s),maxTemp:Math.round(a),description:n.description,icon:n.icon}});return{list:e.list,daily:r.slice(0,5)}},$=async e=>{if(!d()||!e||e.length<3)return[];try{const o=`${i}/geo/1.0/direct?q=${encodeURIComponent(e)}&limit=5&appid=${c}`,r=await fetch(o);return r.ok?(await r.json()).map(s=>{const{name:a,country:n,state:h}=s;return h?`${a}, ${h}, ${n}`:`${a}, ${n}`}):(console.warn("Geocoding API request failed:",r.status),[])}catch(o){return console.warn("Geocoding API Error:",o),[]}};export{p as fetchWeatherData,y as fetchWeatherDataByLocation,I as fetchWeatherForecast,E as fetchWeatherForecastByLocation,$ as getCitySuggestions};
